# 🔢 Gemini API 할당량 관리 가이드

> **할당량 소진 시 해결 방법 완벽 가이드**

---

## 📊 **할당량 시스템 이해**

### **핵심 개념:**
```
Google 계정
  └── 프로젝트 A (할당량 독립)
       ├── API 키 1 ─┐
       └── API 키 2 ─┴─→ 같은 할당량 공유
  └── 프로젝트 B (할당량 독립)
       └── API 키 3 ───→ 독립적인 할당량
```

**중요:**
- ✅ **프로젝트별**로 할당량이 독립적
- ❌ 같은 프로젝트 내 여러 키는 할당량 공유
- ✅ 다른 프로젝트는 각자 할당량 보유

---

## ⏰ **할당량 리셋 시간**

### **무료 티어:**
| 메트릭 | 제한 | 리셋 주기 |
|--------|------|----------|
| **RPD** (일일 요청) | 1,500회 | 매일 00:00 UTC<br/>(한국 시간 09:00) |
| **RPM** (분당 요청) | 15회 | 매 1분마다 |
| **TPM** (분당 토큰) | 100만 | 매 1분마다 |

### **유료 티어:**
| 메트릭 | 제한 | 비용 |
|--------|------|------|
| **RPD** | 제한 없음 | 사용량 과금 |
| **RPM** | 1,000-2,000회 | - |
| **TPM** | 400만-1000만 | - |

---

## ❌ **잘못된 방법**

### **X 같은 프로젝트에서 새 키 발급:**
```bash
# 현재 상태
프로젝트: gen-lang-client-0703860354
키 1: AIzaSyC...abc (할당량 소진)

# 새 키 발급
프로젝트: gen-lang-client-0703860354 (동일!)
키 2: AIzaSyC...xyz (새로 발급)

# 결과
❌ 여전히 할당량 소진!
이유: 같은 프로젝트 할당량 공유
```

**효과 없음!** 시간 낭비입니다.

---

## ✅ **올바른 방법**

### **방법 1: 여러 프로젝트 생성** (무료, 추천)

#### **Step 1: 새 프로젝트 생성**

```
https://console.cloud.google.com/projectcreate
```

1. 프로젝트 이름: `blog-automation-1`, `blog-automation-2`, ...
2. "만들기" 클릭

#### **Step 2: API 활성화**

각 프로젝트에서:
```
https://console.cloud.google.com/apis/library/generativelanguage.googleapis.com
```
- "사용 설정" 클릭

#### **Step 3: API 키 생성**

각 프로젝트에서:
```
https://console.cloud.google.com/apis/credentials
```
- "사용자 인증 정보 만들기" → "API 키"

#### **예상 결과:**
```
프로젝트 A: 키1 (할당량 1,500회/일)
프로젝트 B: 키2 (할당량 1,500회/일)
프로젝트 C: 키3 (할당량 1,500회/일)

총: 4,500회/일 사용 가능! ✅
```

---

### **방법 2: 여러 Google 계정 사용** (무료)

#### **계정별 프로젝트:**
```
계정 1 (본인):
  └── 프로젝트: blog-1
       └── 키1: 1,500회/일

계정 2 (서브):
  └── 프로젝트: blog-2
       └── 키2: 1,500회/일

계정 3 (가족/친구):
  └── 프로젝트: blog-3
       └── 키3: 1,500회/일

총: 4,500회/일 ✅
```

**팁:**
- Gmail 무료 계정 생성
- 또는 기존 가족 계정 활용 (동의 하에)

---

### **방법 3: 할당량 리셋 대기** (무료)

#### **일일 할당량 소진 시:**
```
소진 시간: 2025-12-13 15:00
리셋 시간: 2025-12-14 09:00 (한국 시간)

대기 시간: 약 18시간
```

**자동 리셋:**
- 매일 00:00 UTC (한국 09:00)
- 자동으로 1,500회 복구
- 별도 조치 불필요

#### **분당 할당량 초과 시:**
```
15회/분 초과 → 1분 대기 → 자동 복구
```

**우리 시스템이 자동 처리:**
```python
# 1분 대기 후 재시도
time.sleep(60)
retry()
```

---

### **방법 4: 유료 전환** (유료, 무제한)

#### **Google Cloud 결제 연결:**
```
https://console.cloud.google.com/billing
```

**비용:**
| 모델 | 입력 | 출력 |
|------|------|------|
| Gemini 1.5 Flash | $0.075/1M | $0.30/1M |
| Gemini 1.5 Pro | $1.25/1M | $5.00/1M |

**예상 비용:**
- 블로그 글 1개: ₩1-13
- 월 30개 글: ₩390

**장점:**
- ✅ 무제한 사용
- ✅ 속도 제한 완화 (RPM 1,000-2,000)
- ✅ 할당량 걱정 없음

---

## 🚀 **우리 로테이션 시스템**

### **현재 구현:**
```python
# 프로젝트 A: 키1 소진
→ 자동 전환
# 프로젝트 B: 키2 사용 ✅
→ 자동 전환
# 프로젝트 C: 키3 사용 ✅
```

### **GitHub Secrets 설정:**
```json
GEMINI_API_KEYS: [
  "AIzaSyC...key1",  // 프로젝트 A
  "AIzaSyC...key2",  // 프로젝트 B
  "AIzaSyC...key3"   // 프로젝트 C
]
```

**자동 처리:**
- ✅ 할당량 초과 감지
- ✅ 다음 키로 전환
- ✅ 재시도 자동화

---

## 📊 **시나리오별 대응**

### **시나리오 1: 일일 할당량 소진**
```
09:00 - 키1 사용 (0/1,500)
12:00 - 키1 사용 (500/1,500)
15:00 - 키1 소진 (1,500/1,500) ❌

해결책:
→ 키2로 자동 전환 ✅ (0/1,500)
→ 또는 내일 09:00까지 대기
```

### **시나리오 2: 분당 할당량 초과**
```
10:00:00 - 요청 1-15 (15/15)
10:00:30 - 요청 16 ❌ (초과)

해결책:
→ 1분 대기 (자동)
→ 10:01:00 - 자동 복구 (0/15) ✅
```

### **시나리오 3: 모든 키 소진**
```
키1: 1,500/1,500 ❌
키2: 1,500/1,500 ❌
키3: 1,500/1,500 ❌

해결책:
→ 내일 09:00까지 대기
→ 또는 유료 키 추가
→ 또는 새 프로젝트 생성
```

---

## 💡 **할당량 모니터링**

### **사용량 확인:**
```
https://aistudio.google.com/app/apikey
```

각 키별:
- 일일 사용량
- 남은 할당량
- 리셋 시간

### **로그 확인:**
```
GitHub Actions → 워크플로우 로그

✅ API 키 #1 사용 성공
⚠️ API 키 #1 할당량 초과
🔄 API 키 #2로 전환
✅ API 키 #2 사용 성공
```

---

## 🎯 **권장 구성**

### **소규모 (일 5회 미만):**
```
프로젝트 1개 + 키 1개
→ 무료 (1,500회/일)
```

### **중규모 (일 5-15회):**
```
프로젝트 3개 + 키 3개
→ 무료 (4,500회/일)
→ 로테이션 설정
```

### **대규모 (일 15회 이상):**
```
유료 전환
→ 무제한
→ 월 ~₩390
```

---

## ⚠️ **주의사항**

### **할당량 정책:**
- 프로젝트당 할당량 적용
- 계정당 제한 없음 (여러 프로젝트 가능)
- 리셋은 자동 (별도 조치 불필요)

### **금지 사항:**
- ❌ 같은 프로젝트에서 여러 키 (효과 없음)
- ❌ 무분별한 계정 생성 (Google 정책 위반)
- ❌ API 키 공유/판매 (이용 약관 위반)

### **권장 사항:**
- ✅ 프로젝트별 키 발급
- ✅ 적절한 사용 (스팸 방지)
- ✅ 로테이션 시스템 활용

---

## 🎉 **결론**

### **질문: 할당량 소진 시?**

**❌ 새 키 발급 (같은 프로젝트):** 효과 없음
**✅ 새 프로젝트 생성:** 효과 있음
**⏰ 리셋 대기:** 매일 09:00 자동 복구
**💰 유료 전환:** 무제한 사용

### **최고의 방법:**
```
프로젝트 3개 + 로테이션 시스템
→ 완전 무료
→ 4,500회/일
→ 자동 전환
```

---

**우리 시스템은 이미 준비되어 있습니다!**  
**프로젝트 3개만 만들고 키를 등록하세요!** 🚀
